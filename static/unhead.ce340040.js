import{c as t}from"./hookable.b48d7128.js";import{m as e,P as o,d as s,r as n,h as r,a as i,t as a,H as p,V as l,T as c,b as d,e as f}from"./_unhead.28a66058.js";const u={critical:2,high:9,low:12,base:-1,title:1,meta:10};function g(t){if("number"==typeof t.tagPriority)return t.tagPriority;if("meta"===t.tag){if(t.props.charset)return-2;if("content-security-policy"===t.props["http-equiv"])return 0}const e=t.tagPriority||t.tag;return e in u?u[e]:10}const h=[{prefix:"before:",offset:-1},{prefix:"after:",offset:1}];const y=["link","style","script","noscript"];const m=["script","link","bodyAttrs"];function v(){const t=(t,e)=>{const o={},s={};let n;return Object.entries(e.props).forEach((([t,e])=>{t.startsWith("on")&&"function"==typeof e?s[t]=e:o[t]=e})),"dom"===t&&"script"===e.tag&&"string"==typeof o.src&&void 0!==s.onload&&(n=o.src,delete o.src),{props:o,eventHandlers:s,delayedSrc:n}};return s({hooks:{"ssr:render":function(e){e.tags=e.tags.map((e=>m.includes(e.tag)&&Object.entries(e.props).find((([t,e])=>t.startsWith("on")&&"function"==typeof e))?(e.props=t("ssr",e).props,e):e))},"dom:beforeRenderTag":function(e){if(!m.includes(e.tag.tag))return;if(!Object.entries(e.tag.props).find((([t,e])=>t.startsWith("on")&&"function"==typeof e)))return;const{props:o,eventHandlers:s,delayedSrc:n}=t("dom",e.tag);Object.keys(s).length&&(e.tag.props=o,e.tag._eventHandlers=s,e.tag._delayedSrc=n)},"dom:renderTag":function(t){const e=t.$el;if(!t.tag._eventHandlers||!e)return;const o="bodyAttrs"===t.tag.tag&&"undefined"!=typeof window?window:e;Object.entries(t.tag._eventHandlers).forEach((([s,n])=>{const r=`${t.tag._d||t.tag._p}:${s}`,i=s.slice(2).toLowerCase(),a=`data-h-${i}`;if(t.markSideEffect(r,(()=>{})),e.hasAttribute(a))return;const p=n;e.setAttribute(a,""),o.addEventListener(i,p),t.entry&&(t.entry._sde[r]=()=>{o.removeEventListener(i,p),e.removeAttribute(a)})})),t.tag._delayedSrc&&e.setAttribute("src",t.tag._delayedSrc)}}})}const _=["templateParams","htmlAttrs","bodyAttrs"];function k(t,e){let o=t;try{o=decodeURI(t)}catch{}return(o.match(/%(\w+\.+\w+)|%(\w+)/g)||[]).sort().reverse().forEach((o=>{const s=function(t){if(["s","pageTitle"].includes(t))return e.pageTitle;let o;return o=t.includes(".")?t.split(".").reduce(((t,e)=>t&&t[e]||void 0),e):e[t],void 0!==o&&(o||"")}(o.slice(1));"string"==typeof s&&(t=t.replaceAll(new RegExp(`\\${o}(\\W|$)`,"g"),`${s}$1`).trim())})),e.separator&&(t.endsWith(e.separator)&&(t=t.slice(0,-e.separator.length).trim()),t.startsWith(e.separator)&&(t=t.slice(e.separator.length).trim()),t=t.replace(new RegExp(`\\${e.separator}\\s*\\${e.separator}`,"g"),e.separator)),t}const b="undefined"!=typeof window;let H;function x(){return H}async function j(t,e){const o={tag:t,props:{}};return"templateParams"===t?(o.props=e,o):["title","titleTemplate"].includes(t)?(o.textContent=e instanceof Promise?await e:e,o):"string"==typeof e?!!["script","noscript","style"].includes(t)&&("script"===t&&(/^(https?:)?\/\//.test(e)||e.startsWith("/"))?o.props.src=e:o.innerHTML=e,o):(o.props=await async function(t,e){for(const o of Object.keys(e)){const t=o.startsWith("data-");e[o]instanceof Promise&&(e[o]=await e[o]),"true"===String(e[o])?e[o]=t?"true":"":"false"===String(e[o])&&(t?e[o]="false":delete e[o])}return e}(0,{...e}),o.props.children&&(o.props.innerHTML=o.props.children),delete o.props.children,Object.keys(o.props).filter((t=>c.includes(t))).forEach((t=>{["innerHTML","textContent"].includes(t)&&!d.includes(o.tag)||(o[t]=o.props[t]),delete o.props[t]})),["innerHTML","textContent"].forEach((t=>{if("script"===o.tag&&"string"==typeof o[t]&&["application/ld+json","application/json"].includes(o.props.type))try{o[t]=JSON.parse(o[t])}catch(e){o[t]=""}"object"==typeof o[t]&&(o[t]=JSON.stringify(o[t]))})),o.props.class&&(o.props.class=function(t){"object"!=typeof t||Array.isArray(t)||(t=Object.keys(t).filter((e=>t[e])));return(Array.isArray(t)?t.join(" "):t).split(" ").filter((t=>t.trim())).filter(Boolean).join(" ")}(o.props.class)),o.props.content&&Array.isArray(o.props.content)?o.props.content.map((t=>({...o,props:{...o.props,content:t}}))):o)}const w=10;async function O(t){const e=[];return Object.entries(t.resolvedInput).filter((([t,e])=>void 0!==e&&l.includes(t))).forEach((([t,o])=>{const s=f(o);e.push(...s.map((e=>j(t,e))).flat())})),(await Promise.all(e)).flat().filter(Boolean).map(((e,o)=>(e._e=t._i,e._p=(t._i<<w)+o,e)))}function T(){return[s({hooks:{"tag:normalise":function({tag:t}){["hid","vmid","key"].forEach((e=>{t.props[e]&&(t.key=t.props[e],delete t.props[e])}));const e=a(t)||!!t.key&&`${t.tag}:${t.key}`;e&&(t._d=e)},"tags:resolve":function(t){const e={};t.tags.forEach((t=>{const o=(t.key?`${t.tag}:${t.key}`:t._d)||t._p,s=e[o];if(s){let n=null==t?void 0:t.tagDuplicateStrategy;if(!n&&_.includes(t.tag)&&(n="merge"),"merge"===n){const n=s.props;return["class","style"].forEach((e=>{t.props[e]&&n[e]&&("style"!==e||n[e].endsWith(";")||(n[e]+=";"),t.props[e]=`${n[e]} ${t.props[e]}`)})),void(e[o].props={...n,...t.props})}if(t._e===s._e)return s._duped=s._duped||[],t._d=`${s._d}:${s._duped.length+1}`,void s._duped.push(t)}const n=Object.keys(t.props).length+(t.innerHTML?1:0)+(t.textContent?1:0);p.includes(t.tag)&&0===n?delete e[o]:e[o]=t}));const o=[];Object.values(e).forEach((t=>{const e=t._duped;delete t._duped,o.push(t),e&&o.push(...e)})),t.tags=o}}}),s({hooks:{"tags:resolve":t=>{const e=e=>{var o;return null==(o=t.tags.find((t=>t._d===e)))?void 0:o._p};for(const{prefix:o,offset:s}of h)for(const n of t.tags.filter((t=>"string"==typeof t.tagPriority&&t.tagPriority.startsWith(o)))){const t=e(n.tagPriority.replace(o,""));void 0!==t&&(n._p=t+s)}t.tags.sort(((t,e)=>t._p-e._p)).sort(((t,e)=>g(t)-g(e)))}}}),s({hooks:{"tags:resolve":t=>{var e;const{tags:o}=t,s=null==(e=o.find((t=>"title"===t.tag)))?void 0:e.textContent,n=o.findIndex((t=>"templateParams"===t.tag)),r=-1!==n?o[n].props:{};r.pageTitle=r.pageTitle||s||"";for(const i of o)if(["titleTemplate","title"].includes(i.tag)&&"string"==typeof i.textContent)i.textContent=k(i.textContent,r);else if("meta"===i.tag&&"string"==typeof i.props.content)i.props.content=k(i.props.content,r);else if("link"===i.tag&&"string"==typeof i.props.href)i.props.href=k(i.props.href,r);else if("script"===i.tag&&["application/json","application/ld+json"].includes(i.props.type)&&"string"==typeof i.innerHTML)try{i.innerHTML=JSON.stringify(JSON.parse(i.innerHTML),((t,e)=>"string"==typeof e?k(e,r):e))}catch{}t.tags=o.filter((t=>"templateParams"!==t.tag))}}}),s({hooks:{"tags:resolve":t=>{const{tags:e}=t;let o=e.findIndex((t=>"titleTemplate"===t.tag));const s=e.findIndex((t=>"title"===t.tag));if(-1!==s&&-1!==o){const t=n(e[o].textContent,e[s].textContent);null!==t?e[s].textContent=t||e[s].textContent:delete e[s]}else if(-1!==o){const t=n(e[o].textContent);null!==t&&(e[o].textContent=t,e[o].tag="title",o=-1)}-1!==o&&delete e[o],t.tags=e.filter(Boolean)}}}),s({hooks:{"tag:normalise":({tag:t,resolvedOptions:e})=>{!0===e.experimentalHashHydration&&(t._h=r(t)),t.key&&y.includes(t.tag)&&(t._h=i(t.key),t.props[`data-h-${t._h}`]="")}}}),v(),s({hooks:{"tag:normalise":function({tag:t}){void 0!==t.props.body&&(t.tagPosition="bodyClose",delete t.props.body)}}})]}function $(t={}){return[o({document:null==t?void 0:t.document,delayFn:null==t?void 0:t.domDelayFn})]}function E(o={}){const s=function(e={}){let o=[],s={},n=0;const r=t();(null==e?void 0:e.hooks)&&r.addHooks(e.hooks);e.plugins=[...T(),...(null==e?void 0:e.plugins)||[]],e.plugins.forEach((t=>t.hooks&&r.addHooks(t.hooks))),e.document=e.document||(b?document:void 0);const i=()=>r.callHook("entries:updated",a),a={resolvedOptions:e,headEntries:()=>o,get hooks(){return r},use(t){t.hooks&&r.addHooks(t.hooks)},push(t,e){const r={_i:n++,input:t,_sde:{}};return(null==e?void 0:e.mode)&&(r._m=null==e?void 0:e.mode),(null==e?void 0:e.transform)&&(r._t=null==e?void 0:e.transform),o.push(r),i(),{dispose(){o=o.filter((t=>t._i!==r._i||(s={...s,...t._sde||{}},t._sde={},i(),!1)))},patch(t){o=o.map((e=>(e._i===r._i&&(r.input=e.input=t,i()),e)))}}},async resolveTags(){const t={tags:[],entries:[...o]};await r.callHook("entries:resolve",t);for(const e of t.entries){const o=e._t||(t=>t);if(e.resolvedInput=o(e.resolvedInput||e.input),e.resolvedInput)for(const s of await O(e)){const o={tag:s,entry:e,resolvedOptions:a.resolvedOptions};await r.callHook("tag:normalise",o),t.tags.push(o.tag)}}return await r.callHook("tags:resolve",t),t.tags},_popSideEffectQueue(){const t={...s};return s={},t},_elMap:{}};return a.hooks.callHook("init",a),a}({...o,plugins:[...$(o),...(null==o?void 0:o.plugins)||[]]});return o.experimentalHashHydration&&s.resolvedOptions.document&&(s._hash=e(s.resolvedOptions.document)),function(t){H=t}(s),s}export{E as c,x as g};
